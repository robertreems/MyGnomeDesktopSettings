#!/bin/bash

# Install dash-to-dock
# gnome-shell-extension-installer 307

# Enable the dash-to-dock extension
# gnome-extensions enable dash-to-dock@micxgx.gmail.com

# install compiz-alike-magic-lamp-effect@hermes83.github.com
gnome-shell-extension-installer 3740
gnome-extensions enable compiz-alike-magic-lamp-effect@hermes83.github.com

# Install GSConnect
gnome-shell-extension-installer 1319 --no-install
gnome-extensions install gsconnect@andyholmes.github.io.shell-extension.zip
gnome-extensions enable gsconnect@andyholmes.github.io

# Transparent Window movement effect
gnome-shell-extension-installer 1446 --no-install
gnome-extensions install transparent-window-moving@noobsai.github.com.shell-extension.zip
gnome-extensions enable transparent-window-moving@noobsai.github.com

# Configuratie als tekstblok
CONFIG=$(cat <<EOF
[org/gnome/shell/extensions/dash-to-dock]
apply-custom-theme=false
background-opacity=0.80000000000000004
click-action='minimize-or-previews'
custom-theme-shrink=false
dash-max-icon-size=30
dock-position='BOTTOM'
isolate-workspaces=true
multi-monitor=false
preferred-monitor=-2
preferred-monitor-by-connector='eDP-2'
show-apps-at-top=false
shift-click-action='launch'
autohide=true
intellihide=true
intellihide-mode='ALL_WINDOWS'
dock-fixed=false
extend-height=false

[org/gnome/settings-daemon/plugins/color]
night-light-enabled=true
night-light-schedule-automatic=false
night-light-schedule-from=21.0

[desktop/wm/preferences]
mouse-button-modifier='<Alt>'

[org/gnome/desktop/session]
idle-delay=uint32 3600

[org/gnome/shell]
favorite-apps=['joplin-desktop_joplin-desktop.desktop', 'org.gnome.Nautilus.desktop', 'google-chrome.desktop', 'chrome-kjbdgfilnfhdoflbpgamdcdgpehopbep-Default.desktop', 'chrome-fmgjjmmmlfnkbppncabfkddbjimcfncm-Default.desktop', 'org.gnome.Terminal.desktop', 'org.keepassxc.KeePassXC.desktop', 'spotify_spotify.desktop', 'code.desktop', 'chrome-hnpfjngllnobngcgfapefoaidbinmjnm-Default.desktop']

[org/gnome/desktop/input-sources]
mru-sources=[('xkb', 'us')]
per-window=false
sources=[('xkb', 'us+intl')]

[org/gnome/settings-daemon/plugins/media-keys]
terminal=@as []

[org/gnome/desktop/sound]
allow-volume-above-100-percent=true
EOF
)

echo "Configuratie van Gnome settings is toegepast."

# Sla het tekstblok op in een tijdelijk bestand en pas het toe
dconf load / < <(echo "$CONFIG")

# Enable autostart for Syncthing at login by creating a .desktop file
AUTOSTART_DIR="$HOME/.config/autostart"
AUTOSTART_FILE="$AUTOSTART_DIR/syncthing.desktop"

mkdir -p "$AUTOSTART_DIR"
if [ -f "$AUTOSTART_FILE" ]; then
	echo "Autostart file already exists at $AUTOSTART_FILE — leaving unchanged."
else
	if command -v syncthing >/dev/null 2>&1; then
		EXEC_CMD="syncthing -no-browser"
	else
		EXEC_CMD="syncthing -no-browser"
		echo "Warning: 'syncthing' not found in PATH. Desktop file will still be created."
	fi

	cat > "$AUTOSTART_FILE" <<EOF
[Desktop Entry]
Type=Application
Name=Syncthing
Comment=Start Syncthing at login
Exec=$EXEC_CMD
Terminal=false
X-GNOME-Autostart-enabled=true
Hidden=false
EOF

	chmod 644 "$AUTOSTART_FILE"
	echo "Created autostart file: $AUTOSTART_FILE"
fi

# Auto start signal app
SIGNAL_DESKTOP_FILE="/var/lib/snapd/desktop/applications/signal-desktop_signal-desktop.desktop"
SIGNAL_AUTOSTART_FILE="$AUTOSTART_DIR/signal-desktop_signal-desktop.desktop"

if [ -f "$SIGNAL_AUTOSTART_FILE" ]; then
	echo "Signal autostart file already exists at $SIGNAL_AUTOSTART_FILE — leaving unchanged."
else
	cp "$SIGNAL_DESKTOP_FILE" "$SIGNAL_AUTOSTART_FILE"
	echo "Created autostart file for Signal: $SIGNAL_AUTOSTART_FILE"
fi

# Auto start whatsapp app
WHATSAPP_DESKTOP_FILE="/home/robert/.local/share/applications/chrome-hnpfjngllnobngcgfapefoaidbinmjnm-Default.desktop"
WHATSAP_AUTOSTART_FILE="$AUTOSTART_DIR/chrome-hnpfjngllnobngcgfapefoaidbinmjnm-Default.desktop"

if [ -f "$WHATSAP_AUTOSTART_FILE" ]; then
	echo "Whatsapp autostart file already exists at $WHATSAP_AUTOSTART_FILE — leaving unchanged."
else
	cp "$WHATSAPP_DESKTOP_FILE" "$WHATSAP_AUTOSTART_FILE"
	echo "Created autostart file for WhatsApp: $WHATSAP_AUTOSTART_FILE"
fi


# Set Git config.
git config --global user.email "robertreems@gmail.com"
git config --global user.name "Robert"